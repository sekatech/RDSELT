<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Regional Delegate Login</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            primary: '#4F46E5', // Indigo for modern feel
            secondary: '#10B981', // Emerald green
            accent: '#6B7280', // Gray for neutral elements
          },
        },
      },
    };
  </script>
  <script type="module">
    // Import Firebase SDKs
    import { initializeApp } from 'https://www.gstatic.com/firebasejs/9.22.0/firebase-app.js';
    import { 
      getAuth, 
      signInWithEmailAndPassword, 
      createUserWithEmailAndPassword, 
      GoogleAuthProvider, 
      signInWithPopup, 
      onAuthStateChanged,
      sendPasswordResetEmail 
    } from 'https://www.gstatic.com/firebasejs/9.22.0/firebase-auth.js';

    // Firebase configuration
    const firebaseConfig = {
      apiKey: "AIzaSyA7Gen76VCTACO9eFfclR8MWniQCvs8seE",
      authDomain: "regional-deligate-login.firebaseapp.com",
      projectId: "regional-deligate-login",
      storageBucket: "regional-deligate-login.firebasestorage.app",
      messagingSenderId: "1018961911360",
      appId: "1:1018961911360:web:3be16bf5537cb6676a89a5",
      measurementId: "G-SNNTKD2SBP"
    };

    // Initialize Firebase
    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);

    // DOM elements
    const authSection = document.getElementById("auth-section");
    const errorMessage = document.getElementById("error-message");
    const successMessage = document.getElementById("success-message");
    const emailInput = document.getElementById("email");
    const passwordInput = document.getElementById("password");
    const loginBtn = document.getElementById("login-btn");
    const signupBtn = document.getElementById("signup-btn");
    const googleSignInBtn = document.getElementById("google-signin-btn");
    const resetPasswordBtn = document.getElementById("reset-password-btn");

    // Monitor auth state and redirect if logged in
    onAuthStateChanged(auth, (user) => {
      if (user) {
        window.location.href = "dashboard.html";
      } else {
        authSection.classList.remove("hidden");
      }
    });

    // Show error message
    function showError(message) {
      errorMessage.textContent = message;
      errorMessage.classList.remove("hidden");
      successMessage.classList.add("hidden");
    }

    // Show success message
    function showSuccess(message) {
      successMessage.textContent = message;
      successMessage.classList.remove("hidden");
      errorMessage.classList.add("hidden");
    }

    // Handle email/password login
    loginBtn.addEventListener("click", async () => {
      const email = emailInput.value;
      const password = passwordInput.value;
      errorMessage.classList.add("hidden");
      successMessage.classList.add("hidden");
      try {
        loginBtn.textContent = "Logging in...";
        loginBtn.disabled = true;
        await signInWithEmailAndPassword(auth, email, password);
        window.location.href = "dashboard.html";
      } catch (err) {
        showError(err.message);
      } finally {
        loginBtn.textContent = "Login";
        loginBtn.disabled = false;
      }
    });

    // Handle email/password sign-up
    signupBtn.addEventListener("click", async () => {
      const email = emailInput.value;
      const password = passwordInput.value;
      errorMessage.classList.add("hidden");
      successMessage.classList.add("hidden");
      try {
        signupBtn.textContent = "Signing up...";
        signupBtn.disabled = true;
        await createUserWithEmailAndPassword(auth, email, password);
        showSuccess("Account created successfully!");
        setTimeout(() => {
          window.location.href = "db.html";
        }, 1000); // Redirect after 1 second to show success message
      } catch (err) {
        showError(err.message);
      } finally {
        signupBtn.textContent = "Sign Up";
        signupBtn.disabled = false;
      }
    });

    // Handle Google sign-in
    googleSignInBtn.addEventListener("click", async () => {
      errorMessage.classList.add("hidden");
      successMessage.classList.add("hidden");
      try {
        googleSignInBtn.textContent = "Signing in...";
        googleSignInBtn.disabled = true;
        const provider = new GoogleAuthProvider();
        await signInWithPopup(auth, provider);
        window.location.href = "dashboard.html";
      } catch (err) {
        showError(err.message);
      } finally {
        googleSignInBtn.textContent = "Sign in with Google";
        googleSignInBtn.disabled = false;
      }
    });

    // Handle password reset
    resetPasswordBtn.addEventListener("click", async () => {
      const email = emailInput.value;
      errorMessage.classList.add("hidden");
      successMessage.classList.add("hidden");
      if (!email) {
        showError("Please enter an email address.");
        return;
      }
      try {
        resetPasswordBtn.textContent = "Sending...";
        resetPasswordBtn.disabled = true;
        await sendPasswordResetEmail(auth, email);
        showSuccess("Password reset email sent! Check your inbox.");
      } catch (err) {
        showError(err.message);
      } finally {
        resetPasswordBtn.textContent = "Reset Password";
        resetPasswordBtn.disabled = false;
      }
    });
  </script>
</head>
<body class="min-h-screen bg-gradient-to-br from-indigo-100 to-purple-100 flex flex-col items-center justify-center p-4">
  <div class="bg-white p-8 rounded-2xl shadow-xl w-full max-w-md transform transition-all duration-300 hover:scale-105">
    <div id="auth-section" class="hidden">
      <h1 class="text-3xl font-extrabold mb-6 text-center text-primary">Regional Delegate Login</h1>
      <div id="error-message" class="text-red-500 mb-4 hidden text-center font-medium"></div>
      <div id="success-message" class="text-green-500 mb-4 hidden text-center font-medium"></div>
      <div class="mb-6">
        <label class="block text-gray-700 font-semibold mb-2">Email</label>
        <input
          type="email"
          id="email"
          class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary transition duration-200"
          placeholder="Enter your email"
        />
      </div>
      <div class="mb-6">
        <label class="block text-gray-700 font-semibold mb-2">Password</label>
        <input
          type="password"
          id="password"
          class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary transition duration-200"
          placeholder="Enter your password"
        />
      </div>
      <div class="flex space-x-4 mb-6">
        <button
          id="login-btn"
          class="flex-1 bg-primary text-white px-4 py-3 rounded-lg hover:bg-indigo-700 transition duration-200 font-semibold"
        >
          Login
        </button>
        <button
          id="signup-btn"
          class="flex-1 bg-secondary text-white px-4 py-3 rounded-lg hover:bg-emerald-600 transition duration-200 font-semibold"
        >
          Sign Up
        </button>
      </div>
      <button
        id="google-signin-btn"
        class="w-full bg-gray-800 text-white px-4 py-3 rounded-lg hover:bg-gray-900 mb-6 transition duration-200 font-semibold flex items-center justify-center"
      >
        <svg class="w-5 h-5 mr-2" viewBox="0 0 24 24" fill="currentColor">
          <path d="M12.24 10.285V14.4h6.806c-.275 1.765-2.056 5.174-6.806 5.174-4.095 0-7.439-3.389-7.439-7.574s3.345-7.574 7.439-7.574c2.33 0 3.891.989 4.785 1.849l3.254-3.138C18.189 1.186 15.479 0 12.24 0c-6.627 0-12 5.373-12 12s5.373 12 12 12c6.918 0 11.492-4.873 11.492-12 0-.798-.092-1.566-.262-2.298h-11.226z" />
        </svg>
        Sign in with Google
      </button>
      <button
        id="reset-password-btn"
        class="w-full bg-accent text-white px-4 py-3 rounded-lg hover:bg-gray-700 transition duration-200 font-semibold"
      >
        Reset Password
      </button>
    </div>
  </div>
  <footer class="text-center text-gray-500 mt-8 text-sm">
    Powered by Polymath
  </footer>
</body>
</html>